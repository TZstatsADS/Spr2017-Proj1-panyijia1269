---
title: "The analysis of inaugurals during 1913~1953"
author: "Yijia Pan/yp2424"
output:
  html_document: default
  html_notebook: default
---

# Part 2: Analyze the features of these presidents

```{r,include=FALSE}
# load packages
library("rvest")
library("tibble")
library("qdap")
library("sentimentr")
library("gplots")
library("dplyr")
library("tm")
library("syuzhet")
library("factoextra")
library("beeswarm")
library("scales")
library("RColorBrewer")
library("RANN")
library("tm")
library("topicmodels")
source("../lib/plotstacked.R")
source("../lib/speechFuncs.R")
```

## 1. Data harvest: scrap speech URLs from <http://www.presidency.ucsb.edu/>.

```{r, message=FALSE, warning=FALSE,include=FALSE}
### Inauguaral speeches
main.page <- read_html(x="http://www.presidency.ucsb.edu/inaugurals.php")
# Get link URLs
# f.speechlinks is a function for extracting links from the list of speeches. 
inaug=f.speechlinks(main.page)
#head(inaug)
as.Date(inaug[,1], format="%B %e, %Y")
inaug=inaug[-nrow(inaug),] # remove the last line, irrelevant due to error.

#### Nomination speeches
main.page=read_html("http://www.presidency.ucsb.edu/nomination.php")
# Get link URLs
nomin <- f.speechlinks(main.page)
#head(nomin)
#
#### Farewell speeches
main.page=read_html("http://www.presidency.ucsb.edu/farewell_addresses.php")
# Get link URLs
farewell <- f.speechlinks(main.page)
#head(farewell)
```

Using speech metadata posted on <http://www.presidency.ucsb.edu/>, we prepared CSV data sets for the speeches we will scrap. 

```{r}
inaug.list=read.csv("../data/inauglist.csv", stringsAsFactors = FALSE)
nomin.list=read.csv("../data/nominlist.csv", stringsAsFactors = FALSE)
farewell.list=read.csv("../data/farewelllist.csv", stringsAsFactors = FALSE)
```

Scrap the texts of speeches from the speech URLs.

```{r}
speech.list=rbind(inaug.list, nomin.list, farewell.list)
speech.list$type=c(rep("inaug", nrow(inaug.list)),
                   rep("nomin", nrow(nomin.list)),
                   rep("farewell", nrow(farewell.list)))
speech.url=rbind(inaug, nomin, farewell)
speech.list=cbind(speech.list, speech.url)
```

```{r}
# Loop over each row in speech.list
speech.list$fulltext=NA
for(i in seq(nrow(speech.list))) {
  text <- read_html(speech.list$urls[i]) %>% # load the page
    html_nodes(".displaytext") %>% # isloate the text
    html_text() # get the text
  speech.list$fulltext[i]=text
  # Create the file name
  filename <- paste0("../data/fulltext/", 
                     speech.list$type[i],
                     speech.list$File[i], "-", 
                     speech.list$Term[i], ".txt")
  sink(file = filename) %>% # open file to write 
  cat(text)  # write the file
  sink() # close the file
}
```

## 2. data Processing --- generate list of sentences

```{r, message=FALSE, warning=FALSE}
sentence.list=NULL
for(i in 1:nrow(speech.list)){
  sentences=sent_detect(speech.list$fulltext[i],
                        endmarks = c("?", ".", "!", "|",";"))
  if(length(sentences)>0){
    emotions=get_nrc_sentiment(sentences)
    word.count=word_count(sentences)
    # colnames(emotions)=paste0("emo.", colnames(emotions))
    # in case the word counts are zeros?
    emotions=diag(1/(word.count+0.01))%*%as.matrix(emotions)
    sentence.list=rbind(sentence.list, 
                        cbind(speech.list[i,-ncol(speech.list)],
                              sentences=as.character(sentences), 
                              word.count,
                              emotions,
                              sent.id=1:length(sentences)
                              )
    )
  }
}
```

Some non-sentences exist in raw data due to erroneous extra end-of sentence marks. 
```{r}
sentence.list=
  sentence.list%>%
  filter(!is.na(word.count)) 

```

## 3 Data analysis --- Length of sentences

```{r}
sel.comparison=c("HarrySTruman","FranklinDRoosevelt","HerbertHoover","WoodrowWilson","WarrenGHarding")
```

### Overview of sentence length distribution by different types of speeches. 

```{r, fig.width = 6, fig.height = 6}
sentence.list.sel=sentence.list%>%filter(type=="inaug", File%in%sel.comparison, Term==1)
sentence.list.sel$File=factor(sentence.list.sel$File)

sentence.list.sel$FileOrdered=reorder(sentence.list.sel$File, 
                                  sentence.list.sel$word.count, 
                                  mean, 
                                  order=T)


beeswarm(word.count~FileOrdered, 
         data=sentence.list.sel,
         horizontal = TRUE,
         pch=16, col=alpha(brewer.pal(9, "Set1"), 0.6), 
         cex=0.55, cex.axis=0.8, cex.lab=0.8,
         spacing=5/nlevels(sentence.list.sel$FileOrdered),
         las=2, ylab="", xlab="Number of words in a sentence.",
         main="Inaugural Speeches")
```

### Some analysis

We can see from this figure, comparing with other presidents Woodrow Wilson tended to say less words. And most sentences are quite short. In constrast, Herbert Hoover tended to say more. The reason may be when Woodrow Wilson were the president, America was prosper. The US became the leading super power of the world, and old empire states became weaker due to the World War I. Therefore Herbert Hoover tended to say more to encourage the americans and make some promises.

## 4 Data analysis --- Sentiment analysis

### Sentence length variation over the course of the speech, with emotions. 

Here we used the same color theme as in the movie "Inside Out." Yellow means joy, purple means fear, red means anger, green means disgust, blue means sadness.

```{r, fig.height=4, fig.width=4}

f.plotsent.len(In.list=sentence.list, InFile="WoodrowWilson", 
               InType="nomin", InTerm=1, President="WoodrowWilson")

f.plotsent.len(In.list=sentence.list, InFile="WarrenGHarding", 
               InType="nomin", InTerm=1, President="WarrenGHarding")

f.plotsent.len(In.list=sentence.list, InFile="HerbertHoover", 
               InType="nomin", InTerm=1, President="HerbertHoover")

f.plotsent.len(In.list=sentence.list, InFile="FranklinDRoosevelt", 
               InType="nomin", InTerm=1, President="FranklinDRoosevelt")

f.plotsent.len(In.list=sentence.list, InFile="HarrySTruman", 
               InType="nomin", InTerm=1, President="HarrySTruman")
```

### The cluster of emtions of different presidents
```{r, fig.height=6, fig.width=6}
presid.summary=tbl_df(sentence.list)%>%
  filter(type=="nomin", File%in%sel.comparison)%>%
  #group_by(paste0(type, File))%>%
  group_by(File)%>%
  summarise(
    anger=mean(anger),
    anticipation=mean(anticipation),
    disgust=mean(disgust),
    fear=mean(fear),
    joy=mean(joy),
    sadness=mean(sadness),
    surprise=mean(surprise),
    trust=mean(trust)
    #negative=mean(negative),
    #positive=mean(positive)
  )

presid.summary=as.data.frame(presid.summary)
rownames(presid.summary)=as.character((presid.summary[,1]))
km.res=kmeans(presid.summary[,-1], iter.max=200,
              3)
fviz_cluster(km.res, 
             stand=F, repel= TRUE,
             data = presid.summary[,-1], xlab="", xaxt="n",
             show.clust.cent=FALSE)
```

### Some analysis

For Truman: The color of green and red are relatively high in his speech. This coincide the situation of the World War II. Disgust and Anger should be the emotions in his speech script since this shows that his disgust of the Axis Powers and the war. 

For Roosevelt: The color of yellow is dominated. As we know, Roosevelt was famous of his speech and his close relationship with normal blue collar class and farmers. What’s more, as the leader who brought Americans out of the Great Depression, it is reasonable that he used his speech to encourage the Americans with joyful words.

For Hoover: Red and Purple are the main interesting color in his speech. As mentioned before, during his beginning presidency, the society of the US was influenced by the 18th amendment with the popular of gangs and illegal activities. Therefore, in his speech, he was angry about the gang activities.  
For Harding: Similar to Hoover, Purple was also one of the main color. However, the color of yellow was the dominated color. During the presidency of Harding, the economy of the US reached a peak due to the victory of the World War I. Therefore, his speech had lot of joy. What’s more, the Communist Movement was very popular during his time, so in his speech, he showed the motion of fear to warn the Americans that the Communists are coming. 

For Wilson: Happiness was the main topic in this speech. As we know, the World War I was ended quickly after the involvement of the US. The Americans wined the war and gained high reputation among the whole world. What’s more, the economy of the US was not harmed and it was still very prosperity. Therefore, his speech should be joyful. 
